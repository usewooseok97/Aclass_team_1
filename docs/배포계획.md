# Vercel 배포 + GitHub Actions 자동 데이터 수집 계획

## 현재 상황

### 완료된 작업
- Python 스크립트 정상 동작 확인 (256개 축제 수집)
- API URL 수정 완료
- check_api.py 생성 완료
- run_daily.bat 생성 (로컬용)

### 배포 시 문제점
- **Windows Task Scheduler는 로컬 전용** → 배포 후 동작 안 함
- Vercel은 Python 직접 실행 불가
- 현재 GitHub Actions 설정 없음

---

## 해결 방안: GitHub Actions + Vercel 자동 배포

### 동작 흐름

```
[GitHub Actions]                    [Vercel]
     ↓
매일 오전 6시 (KST)
     ↓
Python 스크립트 실행
     ↓
JSON 파일 생성
     ↓
Git commit & push  ──────────────→  자동 재배포
                                        ↓
                                   새 데이터 반영
```

---

## 구현 계획

### 1단계: GitHub Actions Workflow 생성

**파일:** `.github/workflows/daily-data-collection.yml`

```yaml
name: Daily Data Collection

on:
  schedule:
    # 매일 오전 6시 (KST) = UTC 21:00 (전날)
    - cron: '0 21 * * *'
  workflow_dispatch:  # 수동 실행 가능

jobs:
  collect-data:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    - name: Install dependencies
      run: |
        pip install -r SeoulFestivalMap/py_scripts/requirements.txt

    - name: Create .env file
      run: |
        cd SeoulFestivalMap/py_scripts
        echo "SEOUL_API_KEY=${{ secrets.SEOUL_API_KEY }}" >> .env
        echo "NAVER_CLIENT_ID=${{ secrets.NAVER_CLIENT_ID }}" >> .env
        echo "NAVER_CLIENT_SECRET=${{ secrets.NAVER_CLIENT_SECRET }}" >> .env
        echo "KMA_API_KEY=${{ secrets.KMA_API_KEY }}" >> .env

    - name: Run data collection
      run: |
        cd SeoulFestivalMap/py_scripts
        python main.py

    - name: Commit and push
      run: |
        git config user.name "GitHub Actions Bot"
        git config user.email "actions@github.com"
        git add SeoulFestivalMap/public/data/*.json
        git commit -m "chore: daily data update $(date +'%Y-%m-%d')" || exit 0
        git push
```

### 2단계: GitHub Secrets 설정

GitHub 저장소 → Settings → Secrets and variables → Actions

| Secret 이름 | 값 |
|------------|-----|
| `SEOUL_API_KEY` | 서울시 API 키 |
| `NAVER_CLIENT_ID` | 네이버 클라이언트 ID |
| `NAVER_CLIENT_SECRET` | 네이버 시크릿 |
| `KMA_API_KEY` | 기상청 API 키 |

### 3단계: .gitignore 확인

`.env` 파일이 커밋되지 않도록 확인:
```
# .gitignore에 추가
SeoulFestivalMap/py_scripts/.env
```

### 4단계: Vercel 연동 확인

- Vercel이 GitHub 저장소와 연결되어 있으면 push 시 자동 배포
- 별도 설정 불필요

---

## 수정/생성 파일 목록

| 파일 | 작업 |
|------|------|
| `.github/workflows/daily-data-collection.yml` | 신규 생성 |
| `.gitignore` | .env 제외 확인 |

---

## 검증 방법

1. **수동 테스트**
   - GitHub Actions → "Run workflow" 버튼 클릭
   - 로그에서 정상 실행 확인

2. **결과 확인**
   - `public/data/*.json` 파일이 업데이트되었는지 확인
   - Vercel 대시보드에서 자동 배포 확인

3. **스케줄 확인**
   - 다음 날 오전 6시 이후 자동 실행 확인

---

## 비용

- **GitHub Actions**: 무료 (public repo) / 월 2000분 무료 (private repo)
- **Vercel**: 무료 tier로 충분
- **예상 실행 시간**: 약 5-10분/일

---

## 주의사항

1. **API 키 보안**: GitHub Secrets에만 저장, 코드에 하드코딩 금지
2. **커밋 히스토리**: 매일 자동 커밋이 생성됨
3. **실패 시 알림**: GitHub Actions 실패 시 이메일 알림 가능
