# ë°°í¬ ë¬¸ì œ í•´ê²° ê³„íš

## ë¬¸ì œ ì›ì¸ ìš”ì•½

| ë¬¸ì œ | ì›ì¸ | ìƒíƒœ |
|------|------|------|
| Vercel í™˜ê²½ë³€ìˆ˜ | ë¯¸ì„¤ì • | âœ… í•´ê²° ì™„ë£Œ |
| GitHub Actions Python ì—ëŸ¬ | `main.py` ì‹¤í–‰ìœ¼ë¡œ ë³€ê²½ | âœ… ì›Œí¬í”Œë¡œìš° ìˆ˜ì • ì™„ë£Œ |
| ë¹Œë“œ ì—ëŸ¬ + íšŒì›ê°€ì… ì—ëŸ¬ | ESM ëª¨ë“ˆ í•´ì„ ë¬¸ì œ (`.js` í™•ì¥ì í•„ìš”) | ğŸ”´ í•´ê²° í•„ìš” |

---

## í•´ê²° ë°©ì•ˆ

### 1. GitHub Actions Python ì—ëŸ¬ í•´ê²° (í•µì‹¬)

**ì§„ì§œ ë¬¸ì œ:**
- `config.py`ëŠ” GitHubì— ìˆìŒ âœ“
- í•˜ì§€ë§Œ `python -c "from modules import ..."` ì‹¤í–‰ ì‹œ `__file__`ì´ ì •ì˜ë˜ì§€ ì•ŠìŒ
- `weather.py` 13ë²ˆì§¸ ì¤„ì—ì„œ `os.path.abspath(__file__)` ì‹¤íŒ¨

```python
# modules/weather.py:13-14
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
from config import ...  # â† ê²½ë¡œë¥¼ ëª» ì°¾ìŒ
```

**ì˜í–¥ë°›ëŠ” íŒŒì¼:**
- [modules/weather.py:13-14](py_scripts/modules/weather.py#L13-L14)
- [modules/festival.py:16-17](py_scripts/modules/festival.py#L16-L17)
- [modules/place.py:14-15](py_scripts/modules/place.py#L14-L15)

**í•´ê²° ë°©ë²•: ì›Œí¬í”Œë¡œìš°ë¥¼ `main.py` í†µí•© ì‹¤í–‰ìœ¼ë¡œ ë³€ê²½**

```yaml
# .github/workflows/data-collection.yml (ì „ì²´ êµì²´)

name: Data Collection

on:
  schedule:
    - cron: '0 0 1,16 * *'  # ë§¤ì›” 1ì¼, 16ì¼
  workflow_dispatch:

jobs:
  collect-all-data:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          cd py_scripts
          pip install -r requirements.txt

      - name: Run data collection
        env:
          SEOUL_API_KEY: ${{ secrets.SEOUL_API_KEY }}
          NAVER_CLIENT_ID: ${{ secrets.NAVER_CLIENT_ID }}
          NAVER_CLIENT_SECRET: ${{ secrets.NAVER_CLIENT_SECRET }}
          KMA_API_KEY: ${{ secrets.KMA_API_KEY }}
          GOOGLE_PLACES_API_KEY: ${{ secrets.GOOGLE_PLACES_API_KEY }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
        run: |
          cd py_scripts
          python main.py

      - name: Commit and push data
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add public/data/
          git diff --staged --quiet || git commit -m "Update data files"
          git push
```

**ìˆ˜ì •í•  íŒŒì¼:**
- [.github/workflows/data-collection.yml](.github/workflows/data-collection.yml)

---

### 2. ë¹Œë“œ ì—ëŸ¬ + íšŒì›ê°€ì… ì—ëŸ¬ í•´ê²° (ì‹ ê·œ)

**ì—ëŸ¬ ë©”ì‹œì§€:**
```
Cannot find module '@vercel/node'
Cannot find module '/var/task/api/lib/supabase'
Relative import paths need explicit file extensions in ECMAScript imports
```

**ì›ì¸:**
- `package.json`ì— `"type": "module"` â†’ ESM ëª¨ë“œ
- ESMì—ì„œ ìƒëŒ€ ê²½ë¡œ import ì‹œ **`.js` í™•ì¥ì í•„ìˆ˜**
- `@vercel/node` íŒ¨í‚¤ì§€ ë¯¸ì„¤ì¹˜

**í•´ê²° ë°©ë²•:**

1. **`@vercel/node` íŒ¨í‚¤ì§€ ì„¤ì¹˜**
```bash
npm install -D @vercel/node
```

2. **ëª¨ë“  API íŒŒì¼ì˜ ìƒëŒ€ ê²½ë¡œ importì— `.js` í™•ì¥ì ì¶”ê°€**

**ìˆ˜ì •í•  íŒŒì¼ (11ê°œ):**
- `api/auth/login.ts`
- `api/auth/logout.ts`
- `api/auth/me.ts`
- `api/auth/signup.ts`
- `api/auth/withdraw.ts`
- `api/favorites/index.ts`
- `api/favorites/[festivalId].ts`
- `api/reviews/[festivalId].ts`
- `api/reviews/delete/[reviewId].ts`

**ë³€ê²½ ì˜ˆì‹œ:**
```typescript
// Before
import { supabase } from '../lib/supabase';
import { getUserFromRequest } from '../lib/auth';

// After
import { supabase } from '../lib/supabase.js';
import { getUserFromRequest } from '../lib/auth.js';
```

---

## ì‹¤í–‰ ê³„íš

1. **`@vercel/node` íŒ¨í‚¤ì§€ ì„¤ì¹˜**
2. **ëª¨ë“  API íŒŒì¼ì˜ import ê²½ë¡œì— `.js` í™•ì¥ì ì¶”ê°€**
3. **Git push** â†’ Vercel ìë™ ì¬ë°°í¬
4. **í…ŒìŠ¤íŠ¸** - íšŒì›ê°€ì…/ë¡œê·¸ì¸ ë™ì‘ í™•ì¸

---

## ê²€ì¦ ë°©ë²•

1. ë¹Œë“œ ì—ëŸ¬ ì—†ì´ Vercel ë°°í¬ ì„±ê³µ
2. íšŒì›ê°€ì…/ë¡œê·¸ì¸ ê¸°ëŠ¥ ì •ìƒ ë™ì‘
3. GitHub Actions ì›Œí¬í”Œë¡œìš° ì„±ê³µ

í˜„ì¬ ë¡œê·¸ì¸ íšŒì›ê°€ì… ê¸°ëŠ¥ êµ¬í˜„ ì•ˆë¨
ê³„íš ì„¸ì›Œì•¼í•¨
ì—ëŸ¬
build ì—ëŸ¬
11:26:37.456 
api/lib/supabase.ts(1,30): error TS2307: Cannot find module '@supabase/supabase-js' or its corresponding type declarations.
11:26:37.457 
11:26:37.471 
api/lib/auth.ts(1,17): error TS2307: Cannot find module 'jsonwebtoken' or its corresponding type declarations.
11:26:37.471 
api/lib/auth.ts(2,20): error TS2307: Cannot find module 'bcryptjs' or its corresponding type declarations.

íšŒì›ê°€ì… ì—ëŸ¬
Error [ERR_MODULE_NOT_FOUND]: Cannot find package '@supabase/supabase-js' imported from /var/task/api/lib/supabase.js
    at Object.getPackageJSONURL (node:internal/modules/package_json_reader:316:9)
    at packageResolve (node:internal/modules/esm/resolve:774:81)
    at moduleResolve (node:internal/modules/esm/resolve:864:18)
    at moduleResolveWithNodePath (node:internal/modules/esm/resolve:996:14)
    at defaultResolve (node:internal/modules/esm/resolve:1039:79)
    at #cachedDefaultResolve (node:internal/modules/esm/loader:718:20)
    at #resolveAndMaybeBlockOnLoaderThread (node:internal/modules/esm/loader:735:38)
    at ModuleLoader.resolveSync (node:internal/modules/esm/loader:764:52)
    at #resolve (node:internal/modules/esm/loader:700:17)
    at ModuleLoader.getOrCreateModuleJob (node:internal/modules/esm/loader:620:35) {
  code: 'ERR_MODULE_NOT_FOUND'
}
Node.js process exited with exit status: 1. The logs above can help with debugging the issue.
FUNCTION_INVOCATION_FAILED

ê·¸ë¦¬ê³  dbì— ì €ì¥ë˜ëŠ” ë°ì´í„°ê°€ ë­”ì§€ì— ëŒ€í•´ì„œë„ ì•Œë ¤ì¤˜