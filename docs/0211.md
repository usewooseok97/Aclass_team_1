# 2026-02-11 작업 내역

## 요약

| # | 작업 | 상태 |
|---|------|------|
| 1 | 모바일 헤더 간소화 (로그인+검색만) | ✅ |
| 2 | 찜하기 405 에러 수정 (API 아키텍처 변경) | ✅ |
| 3 | 댓글/리뷰 저장 안 되는 문제 수정 | ✅ |
| 4 | 네이버 지도 인증 실패 방어 코드 | ✅ |
| 5 | 리뷰 시스템 UI 개선 (readOnly, 숨김, 닉네임 마스킹) | ✅ |
| 6 | 축제 종료일 제한 제거 | ✅ |
| 7 | 모바일 브레이크포인트 수정 (768px → 1280px) | ✅ |
| 8 | 모바일 로그아웃 드롭다운 안 보이는 문제 수정 | ✅ |

---

## 1. 모바일 헤더 간소화

**문제**: 모바일 헤더에 "서울 축제지도" 텍스트가 공간 차지 + 405px 이하에서 흰색 빈 칸 발생
**해결**: 타이틀 텍스트 제거, 검색+로그인만 표시

| 파일 | 변경 |
|------|------|
| `src/containers/HeaderContainer.tsx` | 모바일 헤더에서 타이틀 제거, SearchInput + AuthButton만 표시 |

---

## 2. 찜하기 405 에러 — API 아키텍처 변경

**문제**: POST `/api/favorites/%EB%82%98%EC%84%A0%3A...` → 405 Method Not Allowed
**원인**: Vercel 파일 기반 동적 라우팅(`[festivalId].ts`)이 URL-encoded 특수문자(`:`, `[`, `]`, 공백)를 매칭 못함. 요청이 `index.ts`(GET만 처리)로 fallthrough됨

**해결**: 동적 라우트 파일 삭제, body/query 파라미터 방식으로 전환

| 파일 | 변경 |
|------|------|
| `api/favorites/index.ts` | GET+POST+DELETE 통합. POST는 body, DELETE는 query param 사용 |
| `api/favorites/[festivalId].ts` | **삭제** |
| `api/reviews/index.ts` | GET+POST 통합. GET은 query param, POST는 body 사용 |
| `api/reviews/[festivalId].ts` | **삭제** |
| `src/lib/api.ts` | URL 경로 대신 body/query param으로 festivalId 전달 |

**변경 전후:**
```typescript
// Before — URL 경로에 festivalId (Vercel 라우팅 실패)
POST /api/favorites/축제%20이름
DELETE /api/favorites/축제%20이름

// After — body/query에 festivalId (라우팅 문제 없음)
POST /api/favorites  body: { festivalId: "축제 이름" }
DELETE /api/favorites?festivalId=축제%20이름
```

---

## 3. 댓글/리뷰 저장 안 되는 문제

**원인 3가지:**
1. `FestivalReviewSection` 컴포넌트가 어디에도 렌더링 안 됨
2. `festivalEndDate`가 `YYYYMMDD` 형식으로 전송되지만 서버는 `YYYY-MM-DD` 기대 (문자열 비교 오류)
3. 찜하기와 동일한 URL 인코딩 문제

**해결:**

| 파일 | 변경 |
|------|------|
| `src/containers/LeftContentDetail.tsx` | FestivalReviewSection 추가 (리뷰+주변맛집 구조) |
| `src/components/FestivalReviewSection.tsx` | YYYYMMDD → YYYY-MM-DD 변환 로직 추가 |
| `api/reviews/index.ts` | body에서 festivalId 수신 (위 #2와 동일) |

---

## 4. 네이버 지도 인증 실패 방어 코드

**문제**: 네이버 지도 API 인증 실패 시 `naver.maps.Event.addListenerOnce is not a function` 에러
**해결**: `addListener` 함수 존재 여부 체크 후 호출, 없으면 에러 메시지 표시

| 파일 | 변경 |
|------|------|
| `src/hooks/useNaverMap.ts` | `typeof naver.maps.Event.addListener === 'function'` 방어 코드 추가 |

---

## 5. 리뷰 시스템 UI 개선

### 5-1. 리스트 페이지 — 읽기 전용 리뷰

**문제**: 리스트에서 축제 클릭 시 댓글이 안 보임
**해결**: `FestivalReviewSection`에 `readOnly` prop 추가, `LeftContent.tsx`에서 `readOnly` 모드로 렌더링

### 5-2. 상세 페이지 — 작성 후 입력폼 숨김

**문제**: 1인 1댓글인데 작성 후에도 입력폼이 계속 보임
**해결**: `hasSubmitted` state 추가. fetch 시 현재 유저 리뷰 존재 확인 + 작성 성공 시 true 설정 → 입력폼 숨김

### 5-3. 닉네임 마스킹

4자 이하 → 그대로 표시, 4자 초과 → 앞 4자 + `**`

| 파일 | 변경 |
|------|------|
| `src/components/FestivalReviewSection.tsx` | `readOnly` prop, `hasSubmitted` state, 유저 리뷰 감지 |
| `src/containers/LeftContent.tsx` | `ChalkboardCommentSection` → `FestivalReviewSection(readOnly)` 교체, `CODENAME` → `TITLE` |
| `src/atoms/ChalkboardComment.tsx` | `maskNickname()` 함수 추가 + 닉네임 표시 |

---

## 6. 축제 종료일 제한 제거

**이유**: 축제 기간 지나면 JSON에서 사라지므로 사이트에 존재하는 동안은 댓글 작성 가능해야 함
**참고**: 축제가 JSON에서 사라져도 DB의 리뷰/찜 데이터는 영구 보존 (FK 없음, festival_id는 TEXT)

| 파일 | 변경 |
|------|------|
| `api/reviews/index.ts` | GET: `.gte('festival_end_date', today)` 필터 제거, POST: 종료일 validation 제거 |

---

## 7. 모바일 브레이크포인트 수정 (768px → 1280px)

**문제**: `md:768px`에서 MobileTabBar가 숨겨지지만, 두 섹션이 나란히 배치되려면 ~1248px 필요 (`min-w-146` × 2 + `gap-20` = 584+584+80). 768~1248px에서 레이아웃이 wrap되는데 MobileTabBar가 없음

**해결**: Tailwind `md` 브레이크포인트를 1280px로 변경. 프로젝트에서 사용되는 브레이크포인트는 `md:`와 `2xl:`뿐이므로 screens 전체 오버라이드.

| 파일 | 변경 |
|------|------|
| `tailwind.config.js` | `screens: { 'md': '1280px', '2xl': '1536px' }` 추가 |
| `src/containers/FestivalListContainer.tsx` | `matchMedia('(max-width: 767px)')` → `(max-width: 1279px)` |

**자동 적용되는 파일 (코드 수정 없음):** App.tsx, HeaderContainer.tsx, MobileTabBar.tsx, LeftSectionContainer.tsx, RightSectionContainer.tsx, FooterContainer.tsx, CardLayout.tsx, SearchInput.tsx, GridButtonGroup.tsx, SeoulMapContainer.tsx, LeftContent.tsx, NotFoundPage.tsx

---

## 8. 모바일 로그아웃 드롭다운 안 보이는 문제

**문제**: 모바일에서 로그인 후 닉네임 클릭해도 로그아웃 버튼이 안 보임
**원인**: 모바일 헤더 div에 `overflow-hidden`이 있어서 `absolute` 포지션의 드롭다운이 잘림
**해결**: `overflow-hidden` 제거 (원래 타이틀 텍스트 잘림 방지용이었으나 타이틀은 #1에서 이미 삭제됨)

| 파일 | 변경 |
|------|------|
| `src/containers/HeaderContainer.tsx` | 모바일 헤더 div에서 `overflow-hidden` 제거 |

---

## 전체 수정 파일 목록

| 파일 | 변경 내용 |
|------|----------|
| `tailwind.config.js` | md 브레이크포인트 1280px |
| `src/containers/HeaderContainer.tsx` | 모바일 헤더 간소화, overflow-hidden 제거 |
| `src/containers/LeftContent.tsx` | FestivalReviewSection(readOnly) 적용 |
| `src/containers/LeftContentDetail.tsx` | FestivalReviewSection 추가 |
| `src/containers/FestivalListContainer.tsx` | matchMedia 1279px |
| `src/components/FestivalReviewSection.tsx` | readOnly, hasSubmitted, 날짜 변환 |
| `src/atoms/ChalkboardComment.tsx` | 닉네임 마스킹 |
| `src/hooks/useNaverMap.ts` | addListener 방어 코드 |
| `src/lib/api.ts` | body/query param 방식으로 전환 |
| `api/favorites/index.ts` | GET+POST+DELETE 통합 |
| `api/reviews/index.ts` | GET+POST 통합, 종료일 제한 제거 |
| `api/favorites/[festivalId].ts` | **삭제** |
| `api/reviews/[festivalId].ts` | **삭제** |
| `index.html` | OG 메타태그 절대경로 + 도메인 수정 |
| `public/robots.txt` | Sitemap 도메인 수정 |

---

## 9. 카카오톡 링크 미리보기 안 되는 문제 수정

**문제**: 아이폰 카카오톡에서 사이트 링크 공유 시 미리보기(제목, 설명, 이미지 카드)가 안 뜸

**원인 3가지:**
1. `og:image`가 `/og-image.png` (상대경로) → 카카오톡 크롤러는 **절대경로(full URL)** 필수
2. `og-image.png` 파일이 `public/` 폴더에 존재하지 않음
3. `og:url`이 `https://seoulfestivalmap.com` → 실제 도메인 `seoulfestivalmap.vercel.app`과 불일치. 크롤러가 og:url을 따라가서 404 발생

**참고**: SPA(React/Vite)라도 `index.html`에 정적으로 OG 태그가 있으므로 크롤러가 읽을 수 있음. SSR 전환 불필요.

**해결:**

| 파일 | 변경 |
|------|------|
| `index.html` | `og:image` → `https://seoulfestivalmap.vercel.app/og-image.png` (절대경로) |
| `index.html` | `og:url` → `https://seoulfestivalmap.vercel.app` (실제 도메인) |
| `index.html` | `twitter:image` → 동일하게 절대경로로 수정 |
| `public/robots.txt` | Sitemap URL → `https://seoulfestivalmap.vercel.app/sitemap.xml` |

**사용자 필요 작업:**
1. `public/og-image.png` 대표 이미지 생성 (800×400px 이상, PNG/JPG, 500KB 이하)
2. 배포 후 https://developers.kakao.com/tool/clear/og 에서 OG 캐시 초기화
3. https://developers.kakao.com/tool/debugger/sharing 에서 미리보기 확인

**출처:**
- [카카오톡 스크랩 체크리스트](https://devtalk.kakao.com/t/scrap-url/116202)
- [카카오톡 og:image 미노출](https://devtalk.kakao.com/t/topic/132486)
- [OG 이미지 절대경로 필수](https://www.designkits.co.kr/blog/know-how/Open-Graph)
