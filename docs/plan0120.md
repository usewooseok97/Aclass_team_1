# API 데이터 수집 계획 (2025.01.20)

## 현재 상태

### 완성된 구조
```
py_scripts/
├── config.py              # API 키 관리 (현재 하드코딩됨)
├── main.py                # 전체 실행 컨트롤러
├── requirements.txt       # requests, python-dotenv
├── generate_sample_data.py
└── modules/
    ├── festival.py        # 서울시 API + 네이버 검색량
    ├── place.py           # 네이버 지역검색
    └── weather.py         # 기상청 API
```

### 데이터 저장 위치
```
public/data/
├── festival_data.json     # 축제 목록 + buzz_score
├── place_data.json        # 축제별 맛집/카페
└── weather_data.json      # 실시간 날씨
```

---

## 사용 API 목록

### 1. 서울시 문화행사 정보 API
| 항목 | 내용 |
|------|------|
| 용도 | 서울 축제/행사 목록 수집 |
| 엔드포인트 | `http://openapi.seoul.go.kr:8088/{key}/json/culturalEventInfo/1/1000/{start}/{end}` |
| 키 이름 | `SEOUL_API_KEY` |
| 발급처 | [서울 열린데이터 광장](https://data.seoul.go.kr/) |
| 호출 제한 | 일 1,000회 |

### 2. 네이버 검색 API (블로그)
| 항목 | 내용 |
|------|------|
| 용도 | 축제 관심도(buzz_score) 계산 |
| 엔드포인트 | `https://openapi.naver.com/v1/search/blog.json` |
| 키 이름 | `NAVER_CLIENT_ID`, `NAVER_CLIENT_SECRET` |
| 발급처 | [네이버 개발자센터](https://developers.naver.com/) |
| 호출 제한 | 일 25,000회 |

### 3. 네이버 지역검색 API
| 항목 | 내용 |
|------|------|
| 용도 | 축제 주변 맛집/카페 검색 |
| 엔드포인트 | `https://openapi.naver.com/v1/search/local.json` |
| 키 이름 | `NAVER_CLIENT_ID`, `NAVER_CLIENT_SECRET` (블로그와 동일) |
| 발급처 | [네이버 개발자센터](https://developers.naver.com/) |
| 호출 제한 | 일 25,000회 |

### 4. 기상청 단기예보 API
| 항목 | 내용 |
|------|------|
| 용도 | 서울 실시간 날씨 정보 |
| 엔드포인트 | `https://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getUltraSrtNcst` |
| 키 이름 | `KMA_API_KEY` |
| 발급처 | [공공데이터포털](https://www.data.go.kr/data/15084084/openapi.do) |
| 호출 제한 | 일 10,000회 |

---

## API 키 관리 방안

### 현재 문제점
```python
# config.py - API 키가 하드코딩됨 (보안 위험)
SEOUL_API_KEY = os.getenv("SEOUL_API_KEY", "7a77616b456b...")
```

### 개선 방안: .env 파일 사용

**1. py_scripts/.env 생성**
```env
# 서울시 열린데이터
SEOUL_API_KEY=your_seoul_api_key

# 네이버 개발자센터
NAVER_CLIENT_ID=your_client_id
NAVER_CLIENT_SECRET=your_client_secret

# 기상청 공공데이터
KMA_API_KEY=your_kma_api_key
```

**2. config.py 수정**
```python
from dotenv import load_dotenv
import os
from pathlib import Path

# .env 파일 로드
load_dotenv()

# 환경변수에서 API 키 읽기 (하드코딩 제거)
SEOUL_API_KEY = os.getenv("SEOUL_API_KEY")
NAVER_CLIENT_ID = os.getenv("NAVER_CLIENT_ID")
NAVER_CLIENT_SECRET = os.getenv("NAVER_CLIENT_SECRET")
KMA_API_KEY = os.getenv("KMA_API_KEY")

# 키 유효성 검사
def validate_keys():
    missing = []
    if not SEOUL_API_KEY: missing.append("SEOUL_API_KEY")
    if not NAVER_CLIENT_ID: missing.append("NAVER_CLIENT_ID")
    if not NAVER_CLIENT_SECRET: missing.append("NAVER_CLIENT_SECRET")
    if not KMA_API_KEY: missing.append("KMA_API_KEY")

    if missing:
        raise ValueError(f"Missing API keys: {', '.join(missing)}")
```

**3. .gitignore에 추가**
```
py_scripts/.env
```

**4. .env.example 생성 (템플릿)**
```env
SEOUL_API_KEY=
NAVER_CLIENT_ID=
NAVER_CLIENT_SECRET=
KMA_API_KEY=
```

---

## 데이터 수집 프로세스

### 실행 순서
```
python main.py
│
├─ [1] festival.py
│   ├─ 서울시 API → 축제 목록 수집
│   ├─ 네이버 블로그 API → 검색량 조회
│   ├─ buzz_score 계산 (로그 스케일 0-100)
│   └─ 저장: festival_data.json
│
├─ [2] place.py (festival_data.json 필요)
│   ├─ 축제별 구명 추출
│   ├─ 네이버 지역검색 → 맛집/카페 조회
│   └─ 저장: place_data.json
│
└─ [3] weather.py
    ├─ 기상청 API → 실시간 날씨
    └─ 저장: weather_data.json
```

### 데이터 흐름
```
[Python Scripts] → [public/data/*.json] → [React fetch] → [FestivalContext] → [UI]
```

---

## 실행 방법

### 1. 의존성 설치
```bash
cd py_scripts
pip install -r requirements.txt
```

### 2. .env 파일 생성 및 API 키 입력
```bash
cp .env.example .env
# .env 파일 열어서 실제 API 키 입력
```

### 3. 데이터 수집 실행
```bash
python main.py
```

### 4. 결과 확인
```bash
# 생성된 JSON 파일 확인
ls ../public/data/
```

---

## 수집 주기 권장

| 데이터 | 권장 주기 | 이유 |
|--------|----------|------|
| 축제 | 주 1회 | 행사 정보 변경 빈도 낮음 |
| 맛집 | 주 1회 | 축제 데이터 의존 |
| 날씨 | 일 1회  | 실시간성 필요시 더 자주 |

---

## TODO

- [x] .env 파일 생성
- [x] config.py에서 하드코딩된 키 제거
- [x] .gitignore에 .env 추가
- [x] API 키 유효성 검사 함수 추가
- [ ] API 키 발급 및 .env에 입력
- [ ] main.py 실행 테스트
- [ ] JSON 파일 생성 확인
