# Google Places API 403 오류 원인 및 해결 방법

## 오류 메시지
```
"error": {
  "code": 403,
  "message": "Method doesn't allow unregistered callers (callers without established identity). Please use API Key or other form of API consumer identity to call this API.",
  "status": "PERMISSION_DENIED"
}
```

---

## 원인 분석

### 1. API 키가 .env 파일에 없거나 잘못됨
- `py_scripts/.env` 파일에 `GOOGLE_PLACES_API_KEY`가 없거나 빈 값

**확인 방법:**
```bash
# py_scripts/.env 파일 확인
GOOGLE_PLACES_API_KEY=여기에_실제_키가_있어야_함
```

---

### 2. Google Cloud Console에서 "Places API (New)" 미활성화 (가장 유력)

**해결 방법:**
1. https://console.cloud.google.com/ 접속
2. 프로젝트 선택 (또는 새 프로젝트 생성)
3. **APIs & Services > Library** 이동
4. **"Places API (New)"** 검색 후 **ENABLE** 클릭

> **주의**: "Places API"와 "Places API (New)"는 다릅니다!
> - Places API (Legacy) - 예전 버전
> - **Places API (New)** - 새 버전 (우리가 사용하는 것)

---

### 3. 결제 계정 미연결

Google Cloud는 무료 크레딧을 제공하지만, **결제 계정 연결이 필수**입니다.

**해결 방법:**
1. https://console.cloud.google.com/billing 접속
2. 결제 계정 생성 (신용카드 등록 필요, 실제 결제는 무료 한도 초과 시에만)
3. 프로젝트에 결제 계정 연결

---

### 4. API 키 제한 설정 문제

API 키에 HTTP Referrer나 IP 제한이 걸려 있으면 Python 스크립트에서 호출 시 차단됩니다.

**해결 방법:**
1. https://console.cloud.google.com/apis/credentials 접속
2. 사용 중인 API 키 클릭
3. **Application restrictions** → "None" 선택 (개발 중일 때)
4. **API restrictions** → "Don't restrict key" 또는 "Places API (New)" 추가

---

## 체크리스트

| 항목 | 확인 |
|------|------|
| 1. `.env`에 `GOOGLE_PLACES_API_KEY` 있음 | [ ] |
| 2. API 키가 유효한 값임 (AIza로 시작) | [ ] |
| 3. Google Cloud Console에서 "Places API (New)" 활성화됨 | [ ] |
| 4. 결제 계정이 프로젝트에 연결됨 | [ ] |
| 5. API 키에 제한이 없거나 올바르게 설정됨 | [ ] |

---

## API 키 발급 순서 (처음부터)

### Step 1: Google Cloud 프로젝트 생성
1. https://console.cloud.google.com/ 접속
2. 상단 프로젝트 드롭다운 → "새 프로젝트" 클릭
3. 프로젝트 이름 입력 (예: "seoul-festival-map")

### Step 2: 결제 계정 연결
1. 좌측 메뉴 → Billing
2. "결제 계정 연결" 클릭
3. 카드 정보 입력 (무료 한도 내에서는 결제 안 됨)

### Step 3: Places API (New) 활성화
1. 좌측 메뉴 → APIs & Services → Library
2. "Places API (New)" 검색
3. **ENABLE** 클릭

### Step 4: API 키 생성
1. 좌측 메뉴 → APIs & Services → Credentials
2. "+ CREATE CREDENTIALS" → "API key" 클릭
3. 생성된 키 복사

### Step 5: .env 파일에 키 추가
```env
# py_scripts/.env
GOOGLE_PLACES_API_KEY=AIza여기에복사한키붙여넣기
```

---

## 테스트 방법

Python으로 간단히 테스트:
```python
import requests

API_KEY = "여기에_API_키"
url = "https://places.googleapis.com/v1/places:searchText"

headers = {
    "Content-Type": "application/json",
    "X-Goog-Api-Key": API_KEY,
    "X-Goog-FieldMask": "places.displayName"
}

payload = {
    "textQuery": "서울 카페",
    "languageCode": "ko"
}

response = requests.post(url, headers=headers, json=payload)
print(response.status_code)
print(response.json())
```

- **200**: 성공
- **403**: 위 체크리스트 다시 확인

---

## 참고 링크

- [Google Places API (New) 문서](https://developers.google.com/maps/documentation/places/web-service/op-overview)
- [Google Cloud Console](https://console.cloud.google.com/)
- [API 키 생성 가이드](https://developers.google.com/maps/documentation/places/web-service/get-api-key)
