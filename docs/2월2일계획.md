# 2025년 2월 2일 개발 계획

## 개발 방식: 옵션 2 - 우선순위별 단계적 구현

각 기능을 하나씩 완성한 후 다음 기능으로 넘어가는 방식으로 진행합니다.

---

## Phase 1: 핵심 기능 (HIGH 우선순위)

### 1-1. 날짜 필터 기능 (30-40분)

**목표**: 특정 날짜/기간에 열리는 축제 검색

**사용 라이브러리**:
- `dayjs` (이미 설치됨)

**구현 내용**:

1. **타입 정의** (`src/types/festival.ts`)
```typescript
export type DateFilterType = 'all' | 'upcoming' | 'ongoing';
```

2. **FilterContext 수정** (`src/contexts/FilterContext.tsx`)
   - `dateFilter` 상태 추가
   - `setDateFilter` 함수 추가
   - `filteredFestivals` 로직에 날짜 필터링 추가
   - dayjs 플러그인 사용 (isBetween)

3. **DateFilterButtons 컴포넌트** (`src/components/DateFilterButtons.tsx` - 신규)
   - "전체",  "현재 진행중" 버튼
   - 활성화된 버튼 스타일 표시

4. **RightContent 수정** (`src/containers/RightContent.tsx`)
   - DateFilterButtons 컴포넌트 추가 (FestivalListContainer 상단)

**검증**:
- "다가올 축제" 클릭 → 시작일이 오늘 이후인 축제만 표시
- "현재 진행중" 클릭 → 오늘이 기간 내인 축제만 표시
- "전체" 클릭 → 모든 축제 표시

---

### 1-2. 찜하기/위시리스트 기능 (40-50분)

**목표**: 관심 축제를 저장하고 나중에 볼 수 있는 기능

**구현 내용**:

1. **타입 정의** (`src/types/festival.ts`)
```typescript
// FilterContextValue에 추가
favoriteFestivals: Set<string>;
showFavoritesOnly: boolean;
toggleFavorite: (festivalId: string) => void;
setShowFavoritesOnly: (show: boolean) => void;
```

2. **FilterContext 수정** (`src/contexts/FilterContext.tsx`)
   - `favoriteFestivals` 상태 추가 (Set<string>)
   - `showFavoritesOnly` 상태 추가
   - `toggleFavorite` 함수 구현
   - `filteredFestivals` 로직에 찜하기 필터 추가
   - (선택) LocalStorage 연동하여 새로고침 시에도 유지

3. **FestivalCard 수정** (`src/components/FestivalCard.tsx`)
   - Props에 `isFavorite`, `onToggleFavorite` 추가
   - 하트 아이콘 추가 (좌측 상단)
   - 클릭 시 이벤트 전파 방지 (stopPropagation)

4. **FestivalListContainer 수정** (`src/containers/FestivalListContainer.tsx`)
   - `favoriteFestivals`, `toggleFavorite` 가져오기
   - FestivalCard에 props 전달

5. **RightContent 수정** (`src/containers/RightContent.tsx`)
   - "찜한 축제만 보기" 토글 버튼 추가

**검증**:
- 하트 아이콘 클릭 → 빨간색으로 채워짐
- 다시 클릭 → 회색으로 돌아감
- "찜한 축제만 보기" 활성화 → 찜한 축제만 표시
- (LocalStorage 연동 시) 새로고침 후에도 찜 상태 유지

---

## Phase 2: 추가 기능 (MEDIUM 우선순위)

### 2-1. 거리 표시 기능 (40-50분)

**목표**: 사용자 위치 기반 축제까지의 거리 표시 및 정렬

**사용 라이브러리**:
- `geolib` (이미 설치됨)
- `@uidotdev/usehooks` (이미 설치됨)

**구현 내용**:

1. **타입 정의** (`src/types/festival.ts`)
```typescript
export type SortOption = 'buzz_score' | 'distance';

// FilterContextValue에 추가
sortBy: SortOption;
setSortBy: (option: SortOption) => void;
```

2. **거리 계산 유틸리티** (`src/utils/distance.ts` - 신규)
   - `calculateFestivalDistance()`: 사용자 위치와 축제 간 거리 계산 (geolib 사용)
   - `formatDistance()`: 거리 포맷팅 (1km 미만: "500m", 이상: "1.2km")

3. **FilterContext 수정** (`src/contexts/FilterContext.tsx`)
   - `sortBy` 상태 추가 (기본값: 'buzz_score')

4. **FestivalCard 수정** (`src/components/FestivalCard.tsx`)
   - Props에 `distance?: number` 추가
   - 거리 정보 표시 (MapPin 아이콘 + 거리)

5. **FestivalListContainer 수정** (`src/containers/FestivalListContainer.tsx`)
   - `useGeolocation()` 훅 사용
   - `sortBy`에 따라 정렬 로직 분기
   - 거리 계산 및 FestivalCard에 전달

6. **RightContent 수정** (`src/containers/RightContent.tsx`)
   - "인기순", "가까운 순" 정렬 버튼 추가
   - 위치 권한 없을 시 "가까운 순" 버튼 비활성화

**검증**:
- 브라우저 위치 권한 허용
- "가까운 순" 클릭 → 거리순 정렬
- 각 카드에 거리 표시 (예: "1.2km")
- "인기순" 클릭 → 원래 정렬로 복귀

---

### 2-2. 사용자 평가/후기 기능 (30-40분)

**목표**: 축제별 사용자 리뷰 및 평점

**구현 내용**:

1. **타입 정의** (`src/types/festival.ts`)
```typescript
// ChalkboardComment를 확장
export interface FestivalReview extends ChalkboardComment {
  festivalId: string;
  userName?: string;
}
```

2. **FestivalReviewSection 컴포넌트** (`src/components/FestivalReviewSection.tsx` - 신규)
   - ChalkboardCommentSection 재사용
   - 타이틀을 "축제 리뷰"로 변경
   - Props: `festivalId`, `reviews`, `onSubmit`

3. **LeftContentDetail 수정** (`src/containers/LeftContentDetail.tsx`)
   - NearbyRestaurants 아래에 FestivalReviewSection 추가
   - CardLayout으로 감싸기

4. **(선택) 평점순 정렬 추가**
   - `SortOption`에 'user_rating' 추가
   - 백엔드 연동 전에는 보류 가능

**검증**:
- 축제 상세 페이지에서 리뷰 섹션 확인
- 별점 및 댓글 입력 가능
- 칠판 스타일로 랜덤 위치에 표시
- 입력 후 화면에 즉시 표시

---

## 각 Phase별 완료 기준

### Phase 1 완료 기준
- ✅ 날짜 필터 3개 버튼 동작
- ✅ 찜하기 하트 아이콘 동작
- ✅ "찜한 축제만 보기" 필터 동작
- ✅ TypeScript 빌드 오류 없음

### Phase 2 완료 기준
- ✅ 거리 표시 및 정렬 동작
- ✅ 축제 상세 페이지에 리뷰 섹션 표시
- ✅ 리뷰 작성 및 표시 동작
- ✅ TypeScript 빌드 오류 없음

---

## 전체 타임라인 (예상)

| Phase | 기능 | 예상 시간 | 누적 시간 |
|-------|------|-----------|----------|
| 1-1 | 날짜 필터 | 30-40분 | 40분 |
| 1-2 | 찜하기/위시리스트 | 40-50분 | 1시간 30분 |
| **Phase 1 완료** | - | - | **1시간 30분** |
| 2-1 | 거리 표시 | 40-50분 | 2시간 20분 |
| 2-2 | 사용자 평가/후기 | 30-40분 | 3시간 |
| **전체 완료** | - | - | **약 3시간** |

---

## 백엔드 연동 준비사항 (향후)

### API 엔드포인트 설계

**찜하기 API**:
- `POST /api/favorites/{festivalId}` - 찜하기 추가
- `DELETE /api/favorites/{festivalId}` - 찜하기 취소
- `GET /api/favorites` - 사용자의 찜 목록 조회

**리뷰 API**:
- `GET /api/festivals/{festivalId}/reviews` - 리뷰 목록 조회
- `POST /api/festivals/{festivalId}/reviews` - 리뷰 작성
- `GET /api/festivals/{festivalId}/rating` - 평균 평점 조회

---

## 참고 자료

- [geolib - npm](https://www.npmjs.com/package/geolib)
- [useGeolocation React Hook](https://usehooks.com/usegeolocation)
- [dayjs - npm](https://www.npmjs.com/package/dayjs)
- [dayjs isBetween plugin](https://day.js.org/docs/en/plugin/is-between)
